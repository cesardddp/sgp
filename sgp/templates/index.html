{% extends 'layout.html' %}
{% block link_rel %}
    <link href="{{ url_for('static', filename='css/floatin-label.css') }}" rel="stylesheet">
{% endblock link_rel %}
{% block body %}

<body class="container mx-auto px-6">
    <div class="cloud x2"></div>
    <div id="app">
        <form class="flex flex-col justify-items-center space-y-3" @submit.prevent>

            <div class="relative z-0 w-full mb-5">
                <input type="text" name="nome" placeholder=" " v-model="cliente.nome"
                    class="pt-3 pb-2 block w-full px-0 mt-0 bg-transparent border-0 border-b-2 appearance-none focus:outline-none focus:ring-0 focus:border-black border-gray-200">
                <label class="absolute duration-300 top-3 -z-1 origin-0 text-gray-500" for="nome">Nome</label>
                <!-- <span class="text-sm text-red-600 hidden" id="error">Name is required</span> -->
            </div>
            

            <div class="flex justify-center">
                <div class="relative z-0 w-5/6 mb-5">
                    <input type="text" name="endereco" placeholder=" " v-model="cliente.endereco"
                        class="pt-3 pb-2 block w-full px-0 mt-0 bg-transparent border-0 border-b-2 appearance-none focus:outline-none focus:ring-0 focus:border-black border-gray-200">
                    <label for="endereco"
                        class="absolute duration-300 top-3 -z-1 origin-0 text-gray-500">Endereco</label>
                </div>
                <div class="relative z-0 w-1/6 mb-5">
                    <input type="number" name="numero" v-model="cliente.numero"
                        class="pt-3 pb-2 block w-full px-0 mt-0 bg-transparent border-0 border-b-2 appearance-none focus:outline-none focus:ring-0 focus:border-black border-gray-200">
                    <label for="numero" class="absolute duration-300 top-3 -z-1 origin-0 text-gray-500">NÂº</label>
                </div>
            </div>

            <div class="flex justify-center">
                <div class="relative z-0 w-full">
                    <input type="tel" name="telefone" placeholder=" " v-model="cliente.telefone"
                        class="pt-3 pb-2 block w-full px-0 mt-0 bg-transparent border-0 border-b-2 appearance-none focus:outline-none focus:ring-0 focus:border-black border-gray-200">
                    <label class="absolute duration-300 top-3 -z-1 origin-0 text-gray-500"
                        for="telefone">Telefone</label>
                </div>
            </div>


            <div class="flex justify-center">
                <div class="relative z-0 w-full">
                    <input type="date" name="data" v-model="cliente.data"
                        class="pt-3 pb-2 block w-full px-0 mt-0 bg-transparent border-0 border-b-2 appearance-none focus:outline-none focus:ring-0 focus:border-black border-gray-200">
                    <!-- <label for="data">Data</label> -->
                </div>
                <div class="relative z-0 w-full">
                    <input type="time" name="hora" v-model="cliente.hora"
                        class="pt-3 pb-2 block  px-0 mt-0 bg-transparent border-0 border-b-2 appearance-none focus:outline-none focus:ring-0 focus:border-black border-gray-200">
                    <!-- <label for="hora">hora</label> -->
                </div>
            </div>

            <div v-for="amb in ambientes" class="relative z-0 w-5/6" :key="amb.id">
                <input type="tel" v-model="amb.nome" placeholder=" "
                    class="pt-3 pb-2 block w-full px-0 mt-0 bg-transparent border-0 border-b-2 appearance-none focus:outline-none focus:ring-0 focus:border-black border-gray-200">
                <label class="absolute duration-300 top-3 -z-1 origin-0 text-gray-500"
                    for="ambiente-1">{{'{{'}}amb.label{{'}}'}}</label>
            </div>
            <button class="self-end bg-blue-500 hover:bg-blue-700 text-white py-2 px-4 rounded-full"
                @click="add_amb">+ambs</button>

            </form>
            <button @click="novoProjeto" class="btn bg-red-200 hover:bg-red-300 py-2 px-4 rounded-b-3xl">Novo Projeto</button>
    </div>
	<script src="https://cdn.jsdelivr.net/npm/axios@0.12.0/dist/axios.min.js"></script>
    <script type="application/javascript">
        const App = {
            data() {
                return {
                    ultimo: 1,
                    ambientes: [
                        { nome: "", id: 1, label: "Ambiente 1" }
                    ],
                    cliente:{
                        nome:"cesar",
                        endereco:"longe pakas",
                        telefone:"19 929 919911",
                        numero:1300,
                        data:"3/12/2021",
                        hora:"11:12"
                    },
                }
            },
            methods: {
                add_amb() {
                    this.ultimo = this.ultimo + 1
                    console.log(this.ultimo, this.ambientes)
                    this.ambientes.push(
                        { nome: `ambiente-${this.ultimo}`, id: this.ultimo, label: 'Ambiente ' + this.ultimo }
                    )
                },
                novoProjeto(){
                    const iso_data = new Date(
                        this.cliente.data+' '+this.cliente.hora
                        ).toISOString();
                    // console.log(iso_data);
                    // console.log(this.ambientes);
                    this.ambientes.forEach(element => {
                            delete(element.id);delete(element.label)
                        })
                    let projeto = {
                        usuario_id:1,
                        cliente_id:null,
                        cliente:{
                            endereco:this.cliente.endereco,
                            nome:this.cliente.nome,
                            telefone:this.cliente.telefone
                        },
                        ambientes:this.ambientes,
                        data_entrada:iso_data
                    }
                    console.log(projeto);
                    debugger
                    axios
                    .post(
                        "{{ url_for('projeto_bp.novo_projeto') }}",
                        projeto
                        )
                        .then(response => {
                            console.log(response);
                            
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                }

                
            },
            watch:{
                // 'cliente.nome':function(){
				// 	this.busca.trim() ? this.faz_busca() : null
                // },

            }
        }
        var app = Vue.createApp(App)
        app.mount("#app")
    </script>
</body>

{% endblock body %}